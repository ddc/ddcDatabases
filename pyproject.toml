[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "ddcDatabases"
version = "3.0.7"
description = "Simplified database ORM connections with support for multiple database engines"
license = {text = "MIT"}
readme = "README.md"
authors = [{name = "Daniel Costa", email = "danieldcsta@gmail.com"}]
maintainers = [{name = "Daniel Costa"}]
keywords = [
    "python3", "python-3", "python",
    "databases", "database", "ddcDatabases",
    "mssql", "mssql-database",
    "mysql", "mysql-database",
    "oracle", "oracle-database",
    "mariadb", "mariadb-database",
    "mongodb", "mongodb-database",
    "sqlite", "sqlite3", "sqlite3-database",
    "pgsql", "postgres", "postgresql", "postgresql-database",
]
classifiers = [
    "Topic :: Software Development :: Libraries :: Python Modules",
    "Development Status :: 5 - Production/Stable",
    "License :: OSI Approved :: MIT License",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Programming Language :: Python :: 3.14",
    "Operating System :: OS Independent",
    "Environment :: Other Environment",
    "Intended Audience :: Developers",
    "Natural Language :: English",
]
requires-python = ">=3.12"
dependencies = [
    "pydantic-settings>=2.12.0",
    "sqlalchemy[asyncio]>=2.0.46"
]

[project.urls]
Homepage = "https://pypi.org/project/ddcDatabases"
Repository = "https://github.com/ddc/ddcDatabases"

[project.optional-dependencies]
mongodb = ["motor>=3.7.1"]
mssql = ["pyodbc>=5.3.0", "aioodbc>=0.5.0"]
mysql = ["mysqlclient>=2.2.7", "aiomysql>=0.3.2"]
oracle = ["oracledb>=3.4.1"]
pgsql = ["psycopg[binary]>=3.3.2", "asyncpg>=0.31.0"]
all = [
    "ddcDatabases[mongodb]",
    "ddcDatabases[mssql]",
    "ddcDatabases[mysql]",
    "ddcDatabases[oracle]",
    "ddcDatabases[pgsql]",
]
test = [
    "poethepoet>=0.40.0",
    "pytest-asyncio>=1.3.0",
    "pytest-cov>=7.0.0",
]
integration = [
    "ddcDatabases[all]",
    "ddcDatabases[test]",
    "testcontainers[postgres,mysql,mssql,mongodb,oracle]>=4.14.0",
]

[tool.hatch.build]
include = ["ddcDatabases/**/*"]

[tool.hatch.build.targets.wheel]
packages = ["ddcDatabases"]

[tool.poe.tasks]
build = "uv build --wheel"
updatedev.shell = "uv lock && uv sync --all-extras"
linter.shell = "uv run ruff check --fix --select I . && uv run black ."
profile = "uv run python -m cProfile -o cprofile_unit.prof -m pytest tests/unit --no-cov"
profile-integration = "uv run python -m cProfile -o cprofile_integration.prof -m pytest tests/integration --no-cov"
test = "uv run pytest tests/unit"
test-integration = "uv run pytest tests/integration --no-cov"

[tool.pytest.ini_options]
addopts = "-v --cov --cov-report=term --cov-report=xml --junitxml=junit.xml"
junit_family = "legacy"
testpaths = ["tests/unit"]
asyncio_mode = "strict"
asyncio_default_fixture_loop_scope = "function"
markers = [
    "integration: integration tests requiring Docker (deselect with '-m \"not integration\"')",
]

[tool.coverage.run]
omit = [
    "tests/*",
    "*/__init__.py",
    "*/_version.py",
]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "if self.debug:",
    "if settings.DEBUG",
    "raise AssertionError",
    "raise NotImplementedError",
    "if 0:",
    "if __name__ == .__main__.:",
    "class .*\\bProtocol\\):",
    "@(abc\\.)?abstractmethod",
]
show_missing = true
skip_covered = false

[tool.black]
line-length = 120
skip-string-normalization = true

[tool.ruff]
line-length = 120

[tool.ruff.lint]
select = ["I"]

[tool.ruff.lint.isort]
known-first-party = ["ddcDatabases"]
force-sort-within-sections = true
no-sections = true
